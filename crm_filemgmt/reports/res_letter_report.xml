<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="res_letter_report_document" inherit_id="crm_lettermgmt.res_letter_report_document">
        <xpath expr="//tr[@t-if='o.track_ref']" position="after">
            <t t-if="o.file_id" name="file_field_in_main_data">
                <tr t-if="o.file_id.name">
                    <td><b>File</b></td>
                    <td class="text-right"><span t-field="o.file_id.name"/></td>
                </tr>
            </t>
        </xpath>
        <xpath expr="//t[@t-if='o.note']" position="after">
            <t t-if="o.file_id" name="file_details">
                <div name="file_title" style="border-bottom: 1px solid black;">
                    <span><b>F I L E</b></span>
                </div>
                <div name="issue" t-if="o.name" style="margin-top:16px;">
                    <span><b>Issue: </b></span><span t-field="o.file_id.subject"/>
                </div>
                <div name="file_data" class="col-xs-12" style="display:table; margin-top:8px; margin-bottom:24px;">
                    <div style="width: 50%; display: table-cell; border-right: 1px solid black; padding-right: 24px;">
                        <table style="width: 100%;">
                            <tbody>
                                <tr t-if="o.file_id.name">
                                    <td><b>Code</b></td>
                                    <td class="text-right"><span t-field="o.file_id.name"/></td>
                                </tr>
                                <tr t-if="o.file_id.stage_id">
                                    <td><b>Stage</b></td>
                                    <td class="text-right"><span t-field="o.file_id.stage_id"/></td>
                                </tr>
                                <tr t-if="o.file_id.category_id">
                                    <td><b>Category</b></td>
                                    <td class="text-right"><span t-field="o.file_id.category_id"/></td>
                                </tr>
                                 <tr t-if="o.file_id.technician_id">
                                    <td><b>Technician</b></td>
                                    <td class="text-right"><span t-field="o.file_id.technician_id"/></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="display: table-cell; padding-left: 24px;">
                        <table style="width: 100%;">
                            <tbody>
                                <tr t-if="o.file_id.date_file">
                                    <td><b>File Date</b></td>
                                    <td class="text-right"><span t-field="o.file_id.date_file"/></td>
                                </tr>
                                <tr t-if="o.file_id.date_file">
                                    <td><b>Closing Date</b></td>
                                    <td class="text-right"><span t-field="o.file_id.closing_date"/></td>
                                </tr>
                                <tr t-if="o.file_id.container_id">
                                    <td><b>Container</b></td>
                                    <td class="text-right"><span t-field="o.file_id.container_id"/></td>
                                </tr>
                                 <tr t-if="o.file_id.file_attachment_ids">
                                    <t t-set="num_file_attachment_ids" t-value="len(o.file_id.file_attachment_ids)"/>
                                    <td><b>Attachments</b></td>
                                    <td class="text-right"><span t-esc="num_file_attachment_ids"/></td>
                                </tr>
                                <tr t-if="o.file_id.number_of_file_registers">
                                    <td><b>File registers</b></td>
                                    <td class="text-right"><span t-field="o.file_id.number_of_file_registers"/></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <t t-if="len(o.file_id.partnerlink_ids) > 0">
                    <div name="partners_tab_title">
                        <span><b>Partners</b></span>
                    </div>
                    <table class="table table-condensed table-bordered" style="font-size: 0.8em;">
                        <thead>
                            <th width="90%" name="th_name">Name</th>
                            <th width="10%" name="th_main" class="text-center">Primary</th>
                        </thead>
                        <tbody>
                            <t t-foreach="o.file_id.partnerlink_ids" t-as="p" style="page-break-inside: avoid;">
                                <tr>
                                    <td name="td_name">
                                        <span t-field="p.partner_id.display_name"/>
                                    </td>
                                    <td name="td_main" class="text-center">
                                        <t t-if="p.is_main"><span class="fa fa-check"/></t>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
                <t t-if="len(o.file_id.filelink_ids) > 0">
                    <div name="files_tab_title">
                        <span><b>Files</b></span>
                    </div>
                    <table class="table table-condensed table-bordered" style="font-size: 0.8em;">
                        <thead>
                            <th name="th_related_file_category">Category</th>
                            <th name="th_related_file">Related File</th>
                        </thead>
                        <tbody>
                            <t t-foreach="o.file_id.filelink_ids" t-as="f" style="page-break-inside: avoid;">
                                <tr>
                                    <td name="td_related_file_category">
                                        <span t-field="f.related_file_category_id"/>
                                    </td>
                                    <td name="td_related_file" >
                                        <span t-field="f.related_file_id"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
                <t t-if="len(o.file_id.file_attachment_ids) > 0">
                    <div name="attachments_tab_title">
                        <span><b>Attachments</b></span>
                    </div>
                    <table class="table table-condensed table-bordered" style="font-size: 0.8em;">
                        <thead>
                            <th width="70%" name="th_attachment_name">Name</th>
                            <th width="15%" name="th_attachment_mimetype">Mime Type</th>
                            <th width="15%" name="th_attachment_file_size">Size</th>
                        </thead>
                        <tbody>
                            <t t-foreach="o.file_id.file_attachment_ids" t-as="a" style="page-break-inside: avoid;">
                                <tr>
                                    <td name="td_attachment_name">
                                        <span t-field="a.datas_fname"/>
                                    </td>
                                    <td name="td_attachment_mimetype">
                                        <span t-field="a.mimetype"/>
                                    </td>
                                    <td name="td_attachment_file_size">
                                        <span t-field="a.file_size"/>
                                        <span> bytes</span>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
            </t>
        </xpath>

    </template>

</odoo>
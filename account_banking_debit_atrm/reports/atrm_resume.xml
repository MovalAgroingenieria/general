<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Paper format for atrm reports -->
    <record id="paperformat_atrm_reports" model="report.paperformat">
        <field name="name">European A4 ATRM Reports</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">38</field>
        <field name="margin_bottom">28</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">30</field>
        <field name="dpi">90</field>
    </record>

    <!-- QWeb Report -->
    <report id="action_atrm_resume_report"
        string="ATRM_resume"
        model="account.payment.order"
        report_type="qweb-pdf"
        paperformat="paperformat_atrm_reports"
        file="account_banking_debit_atrm.print_atrm_resume_main"
        name="account_banking_debit_atrm.print_atrm_resume_main"
        attachment="('ATRM_' + object.atrm_filename[:-4] + '.pdf')"
        menu="False">
    </report>
    <record id="account_banking_debit_atrm.action_atrm_resume_report" model="ir.actions.report.xml">
        <field name="print_report_name"><![CDATA[('ATRM_' + object.atrm_filename[:-4] + '.pdf')]]></field>
    </record>

    <!-- Define atrm external layout -->
    <template id="atrm_external_layout">
        <!-- Multicompany -->
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id"></t>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"></t>
        </t>
        <t t-call="account_banking_debit_atrm.atrm_external_layout_header"/>
        <t t-raw="0" />
        <t t-call="account_banking_debit_atrm.atrm_external_layout_footer"/>
    </template>

    <!-- Header -->
    <template id="atrm_external_layout_header">
        <div class="header">
            <div class="col-xs-8"></div>
            <div class="col-xs-4">
                <img src='/account_banking_debit_atrm/static/src/img/atrm_logo.png' style="height: 90px;"/>
            </div>
        </div>
    </template>

    <!-- Footer -->
    <template id="atrm_external_layout_footer">
        <div class="footer" style="font-size: 12px; text-align: left;">
            <strong>Sr. DIRECTOR DE LA AGENCIA TRIBUTARIA DE LA REGION DE MURCIA</strong>
            <br/>
            En cumplimiento de lo dispuesto en la Ley Orgánica 3/2018, de 5 de diciembre, de protección de datos personales
            y garantía de los derechos digitales, se informa que los datos facilitados a través del presente formulario serán
            incorporados a los ficheros de la Agencia Tributaria de la Región de Murcia, ante la cual podrán ejercitar los
            derechos de acceso, rectificación, cancelación y oposición previstos en la citada ley.
        </div>
    </template>

    <!-- Document -->
    <template id="atrm_resume_document">
        <t t-set="doc" t-value="doc.with_context({'lang':doc.generated_user_id.lang})" />
        <t t-call="account_banking_debit_atrm.atrm_external_layout">
            <div class="page">
                <div class="oe_structure"/>
                <div style="background-color: lightgray;">
                    <div class="text-center" style="font-size: 24px">
                        COMUNICACIÓN DE CARGOS A LA AGENCIA TRIBUTARIA
                    </div>
                </div>
                <div class="row" style="border: 1px solid black; margin-top: 20px; margin-left: 1px;margin-right: 1px; ">
                    <div class="col-xs-12" style="display: table;">
                        <div style="width: 80%; display: table-cell; padding: 4px;">
                            <strong>AYUNTAMIENTO / ORGANISMO:</strong>
                            <t t-if="doc.agency">
                                <t t-set="agency" t-value="doc.agency[5:]"/>
                                <span t-esc="agency"/>
                            </t>
                            <br/>
                            <strong>TELÉFONO:</strong>
                            <t t-if="doc.company_id.phone">
                                <span t-field="doc.company_id.phone"/>
                            </t>
                        </div>
                        <div style="width: 20%; display: table-cell; padding: 4px 16px;">
                            <strong>NIF:</strong>
                            <t t-if="doc.company_id.vat">
                               <t t-set="nif" t-value="doc.company_id.vat[2:]"/>
                               <span t-esc="nif"/>
                            </t>
                        </div>
                    </div>
                </div>
                <div class="row" style="border: 1px solid black; margin-top: 16px; margin-left: 1px; margin-right: 1px;">
                    <div class="col-xs-12" style="display: table;">
                        <div style="width: 50%; display: table-cell; padding: 4px; padding-bottom: 20px;">
                            En virtud del Convenio de Recaudación entre este Ayuntamiento/Organismo y
                            la Agencia Tributaria de la Región de Murcia.
                        </div>
                    </div>
                </div>
                <div class="row" style="border: 1px solid black; margin-top: 16px; margin-left: 1px; margin-right: 1px;">
                    <div class="col-xs-12" style="display: table;">
                        <div style="width: 50%; display: table-cell; padding: 4px;">
                            
                            <strong>COMUNICACIÓN:</strong>
                            <br/>
                            <br/>
                            Adjunto remito cargo nº 
                            <t t-if="doc.shipment_num">
                                <span t-field="doc.shipment_num"></span>
                            </t>
                            (<strong>AAAA/NNNN</strong>), para que se proceda a su cobro en vía:
                            <br/>
                            <br/>
                            <div style="display: inline-block; padding-left: 90px;">
                                <t t-if="doc.debt_period == 'V'">
                                    <input type="checkbox" checked="True" style="position: relative; bottom: 4px;"/>
                                </t>
                                <t t-else="">
                                    <input type="checkbox" style="position: relative; bottom: 4px;"/>
                                </t>
                                <span style="padding-left: 10px;">VOLUNTARIA</span>
                            </div>
                            <div style="display: inline-block; padding-left: 90px;">
                                <t t-if="doc.debt_period == 'E'">
                                    <input type="checkbox" checked="True" style="position: relative; bottom: 4px;"/>
                                </t>
                                <t t-else="">
                                    <input type="checkbox" style="position: relative; bottom: 4px;"/>
                                </t>
                                <span style="padding-left: 10px;">EJECUTIVA</span>
                            </div>
                            <div style="display: inline-block; padding-left: 90px;">
                                <t t-if="doc.debt_period == 'B'">
                                    <input type="checkbox" checked="True" style="position: relative; bottom: 4px;"/>
                                </t>
                                <t t-else="">
                                    <input type="checkbox" style="position: relative; bottom: 4px;"/>
                                </t>
                                <span style="padding-left: 10px;">EMBARGO</span>
                            </div>
                            <br/>
                            <br/>
                            <table class="table-bordered" style="max-width: 70%; margin-left: 90px;">
                                <col width="40%"/>
                                <col width="30%"/>
                                <col width="40%"/>
                                <thead>
                                    <tr>
                                        <th style="padding: 4px;">FICHERO</th>
                                        <th style="padding: 4px;">Nº DEUDAS</th>
                                        <th style="padding: 4px;">IMPORTE</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 4px;">
                                            <t t-if="doc.atrm_filename">
                                                <span t-field="doc.atrm_filename"></span>
                                            </t>
                                        </td>
                                        <td class="text-right" style="padding: 4px;">
                                            <t t-if="doc.bank_line_count">
                                                <span t-field="doc.bank_line_count"/>
                                            </t>
                                        </td>
                                        <td class="text-right" style="padding: 4px;">
                                            <t t-if="doc.atrm_total_amount">
                                                <field name="currency_id" invisible="1"/>
                                                <span t-field="doc.atrm_total_amount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                            </t>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                        </div>
                    </div>
                </div>
                <div class="text-center" name="date" style="margin-top: 40px;">
                    En
                    <t t-if="doc.company_id.city">
                        <span t-field="doc.company_id.city"/>
                    </t>
                    a
                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d')"/>
                    de
                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%B')"/>
                    de
                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y')"/>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

    <!-- Main template -->
    <template id="print_atrm_resume_main">
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="account_banking_debit_atrm.atrm_resume_document" t-lang="doc.generated_user_id.lang"/>
            </t>
        </t>
    </template>

</odoo>